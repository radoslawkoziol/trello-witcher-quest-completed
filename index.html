<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sound Power-Up</title>
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<script>
    const SOUND_URL = 'https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3';

    // Funkcja do odtwarzania dÅºwiÄ™ku
    function playSound() {
        try {
            const audio = new Audio(SOUND_URL);
            audio.volume = 0.6;
            audio.play().catch(function(error) {
                console.log('Nie moÅ¼na odtworzyÄ‡ dÅºwiÄ™ku:', error);
            });
        } catch (error) {
            console.log('BÅ‚Ä…d podczas tworzenia audio:', error);
        }
    }

    // Inicjalizacja Power-Up
    window.TrelloPowerUp.initialize({
        'card-badges': function(t, options) {
            return Promise.all([
                t.card('id', 'idList'),
                t.get('board', 'shared', 'targetListId'),
                t.get('card', 'private', 'lastListId')
            ]).then(function([card, targetListId, lastListId]) {
                const currentListId = card.idList;

                // SprawdÅº czy jest skonfigurowana lista docelowa
                if (targetListId && lastListId && lastListId !== currentListId) {
                    // SprawdÅº czy karta zostaÅ‚a przeniesiona DO docelowej listy
                    if (currentListId === targetListId) {
                        console.log('Karta przeniesiona do docelowej listy!');
                        playSound();
                    }
                }

                // Zapisz aktualnÄ… pozycjÄ™ karty
                t.set('card', 'private', 'lastListId', currentListId);

                return [];
            });
        },

        'board-buttons': function(t, options) {
            return [{
                icon: {
                    dark: 'https://cdn-icons-png.flaticon.com/128/727/727269.png',
                    light: 'https://cdn-icons-png.flaticon.com/128/727/727269.png'
                },
                text: 'DÅºwiÄ™k',
                callback: function(t) {
                    // Pobierz wszystkie listy
                    return t.lists('all').then(function(lists) {
                        return t.get('board', 'shared', 'targetListId').then(function(savedListId) {

                            // StwÃ³rz opcje do wyboru
                            const items = lists.map(function(list) {
                                return {
                                    text: list.name + (list.id === savedListId ? ' âœ“' : ''),
                                    callback: function(t) {
                                        return t.set('board', 'shared', 'targetListId', list.id).then(function() {
                                            return t.alert({
                                                message: 'Zapisano: ' + list.name,
                                                duration: 3,
                                                display: 'success'
                                            });
                                        });
                                    }
                                };
                            });

                            // Dodaj opcjÄ™ testowania dÅºwiÄ™ku
                            items.push({
                                text: 'ðŸ”Š Testuj dÅºwiÄ™k',
                                callback: function(t) {
                                    playSound();
                                    return t.closePopup();
                                }
                            });

                            // Dodaj informacjÄ™ o aktualnych ustawieniach
                            let currentListName = 'Brak';
                            if (savedListId) {
                                const currentList = lists.find(function(l) { return l.id === savedListId; });
                                if (currentList) {
                                    currentListName = currentList.name;
                                }
                            }

                            return t.popup({
                                title: 'Wybierz kolumnÄ™ docelowÄ…',
                                items: [{
                                    text: 'Aktualnie: ' + currentListName,
                                    icon: 'https://cdn-icons-png.flaticon.com/128/7334/7334232.png'
                                }].concat([{text: '---'}], items)
                            });
                        });
                    });
                }
            }];
        },

        'show-settings': function(t, options) {
            // MoÅ¼esz teÅ¼ dodaÄ‡ settings w menu Power-Up
            return t.lists('all').then(function(lists) {
                return t.get('board', 'shared', 'targetListId').then(function(savedListId) {

                    const items = lists.map(function(list) {
                        return {
                            text: list.name + (list.id === savedListId ? ' âœ“' : ''),
                            callback: function(t) {
                                return t.set('board', 'shared', 'targetListId', list.id).then(function() {
                                    return t.alert({
                                        message: 'Zapisano: ' + list.name,
                                        duration: 3,
                                        display: 'success'
                                    });
                                });
                            }
                        };
                    });

                    items.push({
                        text: 'ðŸ”Š Testuj dÅºwiÄ™k',
                        callback: function(t) {
                            playSound();
                            return t.closePopup();
                        }
                    });

                    let currentListName = 'Brak';
                    if (savedListId) {
                        const currentList = lists.find(function(l) { return l.id === savedListId; });
                        if (currentList) {
                            currentListName = currentList.name;
                        }
                    }

                    return t.popup({
                        title: 'Wybierz kolumnÄ™ docelowÄ…',
                        items: [{
                            text: 'Aktualnie: ' + currentListName,
                            icon: 'https://cdn-icons-png.flaticon.com/128/7334/7334232.png'
                        }].concat([{text: '---'}], items)
                    });
                });
            });
        }
    });
</script>
</body>
</html>